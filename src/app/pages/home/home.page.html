<ion-header class="ion-no-border">
  <ion-toolbar class="main-toolbar">
    <ion-searchbar
      [(ngModel)]="citySearch"
      (search)="searchCity()"
      (ionInput)="onSearchInput($event)"
      [placeholder]="'HOME.SEARCH_PLACEHOLDER' | translate"
      class="custom-searchbar"
    ></ion-searchbar>

    <ion-buttons slot="end">
      <!-- Custom Language Toggle -->
      <div class="language-toggle">
        <div
          class="toggle-option"
          [class.active]="currentLang === 'en'"
          (click)="currentLang !== 'en' && toggleLanguage()"
        >
          EN
        </div>
        <div
          class="toggle-option"
          [class.active]="currentLang === 'es'"
          (click)="currentLang !== 'es' && toggleLanguage()"
        >
          ES
        </div>
      </div>

      <!-- Location Button -->
      <ion-button
        fill="clear"
        (click)="getCurrentLocation()"
        [disabled]="loadingLocation"
        class="location-button"
      >
        <ion-icon
          slot="icon-only"
          name="locate"
          class="location-icon"
          *ngIf="!loadingLocation"
        ></ion-icon>
        <ion-spinner name="crescent" *ngIf="loadingLocation"></ion-spinner>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Suggestions Dropdown (Floating) -->
  @if (showSuggestions && citySuggestions.length > 0) {
  <div class="suggestions-container">
    <ion-list lines="none" class="glass-list">
      @for (city of citySuggestions; track city.lat) {
      <ion-item button (click)="selectCity(city)" detail="false">
        <ion-label>
          <h3>{{ city.name }}</h3>
          <p>{{ city.state ? city.state + ', ' : '' }}{{ city.country }}</p>
        </ion-label>
      </ion-item>
      }
    </ion-list>
  </div>
  } @if (weatherData) {
  <div class="main-container ion-padding">
    <ion-grid>
      <ion-row class="desktop-split">
        <!-- LEFT COLUMN: Hero & Current Details (Center/Left on Desktop) -->
        <ion-col size-xs="12" size-md="5" size-lg="5" class="left-col">
          <!-- HERO SECTION -->
          <app-current-weather
            [displayDate]="displayDate"
            [currentLang]="currentLang"
            [locationName]="weatherData.current.name || (citySearch | uppercase)"
            [temp]="weatherData.current.temp"
            [tempMax]="weatherData.daily[0].temp.max"
            [tempMin]="weatherData.daily[0].temp.min"
            [iconCode]="weatherData.current.weather[0].icon"
            [description]="weatherData.current.weather[0].description"
          ></app-current-weather>

          <!-- DETAILS GRID -->
          <app-weather-details-grid
            [current]="weatherData.current"
            [currentUnit]="currentUnit"
          ></app-weather-details-grid>
        </ion-col>

        <!-- RIGHT COLUMN: Timeline & Forecast (Right on Desktop) -->
        <ion-col
          size-xs="12"
          size-md="7"
          size-lg="6"
          offset-lg="1"
          class="right-col"
        >
          <!-- SECTIONS -->
          <div class="section-title">
            <span>{{ 'HOME.TIMELINE' | translate }}</span>
          </div>

          <!-- HOURLY -->
          <app-hourly-breakdown
            [hourlyForecast]="weatherData.hourly | slice:0:8"
          ></app-hourly-breakdown>

          <div class="section-title ion-margin-top">
            <span>{{ 'HOME.FORECAST_TITLE' | translate }}</span>
          </div>

          <app-forecast-list
            [dailyForecast]="weatherData.daily | slice:0:5"
            [selectedDayId]="selectedDayId"
            (daySelected)="onDaySelected($event)"
          ></app-forecast-list>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
  } @else {
  <div class="ion-text-center ion-padding loading-container">
    <p class="loading-text">{{ 'HOME.LOADING' | translate }}</p>
    <ion-spinner color="light"></ion-spinner>
  </div>
  }
</ion-content>
